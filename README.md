# Survival Syndicate Server

–ë—ç–∫–µ–Ω–¥ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–æ–π –≤—ã–∂–∏–≤–∞–ª–∫–∏ Survival Syndicate. –ü–æ—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ NestJS —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ Clean Architecture.

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–°–µ—Ä–≤–µ—Ä —è–≤–ª—è–µ—Ç—Å—è **–∞–±—Å–æ–ª—é—Ç–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã** –¥–ª—è –≤—Å–µ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –º–∏—Ä–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —à–∞–≥–æ–º –≤—Ä–µ–º–µ–Ω–∏, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç WebSocket-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞-–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–µ–π (–∑–¥–∞–Ω–∏—è, –±–æ–µ–≤–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è, –∞–∫–∫–∞—É–Ω—Ç—ã –∏–≥—Ä–æ–∫–æ–≤).

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤**: 8 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —á–µ—Ä–µ–∑ NATS
- **Clean Architecture**: –°—Ç—Ä–æ–≥–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ —Å –∏–Ω–≤–µ—Ä—Å–∏–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª**: 30 FPS, —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
- **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ª–∞–≥–∞**: –°–∏—Å—Ç–µ–º–∞ "–æ—Ç–º–æ—Ç–∫–∏" –º–∏—Ä–∞ –¥–ª—è —Ç–æ—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–π
- **–ú–µ—Ç–∞-–ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è**: –ó–¥–∞–Ω–∏—è, Battle Pass (3 —Å—Ç—Ä–∏–º–∞), –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —Ç—Ä–æ—Ñ–µ–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã —Å WebSocket Gateway + Game Server Pods

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

- **`api-gateway`** ‚Äî HTTP —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, Swagger
- **`auth-service`** ‚Äî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, JWT —Ç–æ–∫–µ–Ω—ã, refresh-—Ç–æ–∫–µ–Ω—ã
- **`player-service`** ‚Äî –ê–∫–∫–∞—É–Ω—Ç—ã, –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ (CRUD), –¥—Ä—É–∑—å—è, –±–∞–Ω—ã
- **`building-service`** ‚Äî –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, –∞–ø–≥—Ä–µ–π–¥—ã, –±–æ–Ω—É—Å—ã, —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
- **`combat-progress-service`** ‚Äî Player Level (XP), Battle Pass, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —Ç—Ä–æ—Ñ–µ–∏, –±–æ–µ–≤–æ–π –ø—É–ª
- **`scheduler-service`** ‚Äî Cron/Bull: –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥, —Å–±—Ä–æ—Å –∑–∞–¥–∞–Ω–∏–π, —Ä–æ—Ç–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞, –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã
- **`game-server`** ‚Äî –ò–≥—Ä–æ–≤–∞—è —Å–∏–º—É–ª—è—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (WebSocket, GameLoop, —Ñ–∏–∑–∏–∫–∞, –ª–∞–≥-–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)
- **`analytics-service`** ‚Äî –°–±–æ—Ä —Å–æ–±—ã—Ç–∏–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClickHouse

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: NestJS 11 —Å TypeScript 5.7
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 15 —Å Prisma 7 ORM (Postgres_Meta + Postgres_Catalog)
- **–û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏**: NATS –¥–ª—è request-reply –∏ pub/sub
- **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è**: WebSocket (–±–∏–Ω–∞—Ä–Ω—ã–π/JSON –ø—Ä–æ—Ç–æ–∫–æ–ª)
- **–û—á–µ—Ä–µ–¥–∏**: Bull (Redis) –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: ClickHouse + Yandex DataLens
- **–ö—ç—à/–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: Redis
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: Swagger/OpenAPI

### –°–ª–æ–∏ Clean Architecture

```
Presentation (–í–Ω–µ—à–Ω–∏–π —Å–ª–æ–π)
  ‚Üì –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
Application (Use Cases)
  ‚Üì –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
Domain (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
  ‚Üì –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
Infrastructure (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ API)
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
```
apps/{service}/src/
‚îú‚îÄ‚îÄ domain/              # –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ entities/        # –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ services/        # –î–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ application/         # –°–ª–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ use-cases/       # CQRS –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥/–∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ports/           # –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ infrastructure/      # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ prisma/          # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mapper/      # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ Entity ‚Üî Prisma
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/ # –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îî‚îÄ‚îÄ external/        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚îî‚îÄ‚îÄ presentation/        # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
    ‚îú‚îÄ‚îÄ http/            # HTTP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã + DTOs
    ‚îú‚îÄ‚îÄ nats/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ NATS —Å–æ–æ–±—â–µ–Ω–∏–π
    ‚îî‚îÄ‚îÄ websocket/       # WebSocket –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (game-server)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20+ –∏ npm
- Docker –∏ Docker Compose
- PostgreSQL 15+
- Git

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd survival-syndicate-server

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
npm run docker:infra

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma –∫–ª–∏–µ–Ω—Ç—ã
npm run prisma:generate

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run prisma:migrate:dev
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ª–æ–∫–∞–ª—å–Ω–æ
npm run start:local

# –ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å –≤ —Ä–µ–∂–∏–º–µ watch
npm run start:player-service:dev
npm run start:building-service:dev
npm run start:game-server:dev

# –°–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
npm run build:all
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ **[docs/](docs/)**:

- **[docs/index.md](docs/index.md)** ‚Äî –ò–Ω–¥–µ–∫—Å –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **[docs/01_server_development_guide.md](docs/01_server_development_guide.md)** ‚Äî –ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (`docs/architecture/`)

- –°–µ—Ç–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª (WebSocket)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- –°–µ—Ç–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (Delta, Interest)
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (PostgreSQL, ClickHouse)
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ (—Ü–µ–Ω—Ç—Ä + —Ä–µ–≥–∏–æ–Ω—ã)
- Anti-Cheat –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- Building Service, Combat Progress Service, Player Service, Scheduler Service
- NATS Best Practices
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (NestJS Monorepo)
- Auth & Authorization (JWT, Guards)
- Database Migrations (Prisma ORM)
- Gameplay Service Internals
- Game Simulation Internals

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- [WARP.md](WARP.md) ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤
- [AGENTS.md](AGENTS.md) ‚Äî –ü—Ä–∞–≤–∏–ª–∞ Cursor

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
npm test

# –†–µ–∂–∏–º watch
npm run test:watch

# –ü–æ–∫—Ä—ã—Ç–∏–µ
npm run test:cov

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e
```

## üóÑÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### Prisma

–î–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: **Postgres_Meta** (–¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–≤) –∏ **Postgres_Catalog** (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ñ–∏–≥):

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma –∫–ª–∏–µ–Ω—Ç—ã
npm run prisma:generate

# –ú–∏–≥—Ä–∞—Ü–∏–∏ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
npm run prisma:migrate:dev

# –ú–∏–≥—Ä–∞—Ü–∏–∏ (–¥–µ–ø–ª–æ–π)
npm run prisma:migrate:deploy

# Prisma Studio
npm run prisma:studio:meta
npm run prisma:studio:catalog
```

## üîÑ –ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

### NATS

**–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç–µ NATS subjects. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.**

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
import { PlayerPublisher } from '@lib/lib-player';
const response = await playerPublisher.getCharacter(request);

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
natsClient.send('player.get-character.v1', data);
```

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏:**
- `@lib/lib-player` ‚Äî PlayerPublisher, PlayerSubjects
- `@lib/lib-building` ‚Äî BuildingPublisher, BuildingSubjects
- `@lib/lib-game-server` ‚Äî GameServerPublisher, GameServerSubjects
- `@lib/lib-combat-progress` ‚Äî CombatProgressPublisher, CombatProgressSubjects
- `@lib/lib-analytics` ‚Äî AnalyticsPublisher, AnalyticsSubjects

## üì¶ –ê–ª–∏–∞—Å—ã –ø—É—Ç–µ–π

```typescript
// –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
@app/api-gateway/*
@app/auth-service/*
@app/player-service/*
@app/building-service/*
@app/combat-progress-service/*
@app/scheduler-service/*
@app/game-server/*
@app/analytics-service/*

// –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏
@lib/shared/*
@lib/lib-player/*
@lib/lib-building/*
@lib/lib-game-server/*
@lib/lib-combat-progress/*
@lib/lib-analytics/*

// Prisma
@prisma/meta
@prisma/catalog
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

- **GDD:** https://github.com/recferret-bit/Survival-Syndicate-GDD
- **Client:** https://github.com/recferret-bit/Survival-Syndicate-Client
