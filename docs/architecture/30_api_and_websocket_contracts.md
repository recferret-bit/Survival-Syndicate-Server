# HTTP и WebSocket Контракты

Этот документ описывает контракты для аутентификации, матчмейкинга и игрового процесса.

---

## 1. Auth Service (Сервис Аутентификации)

### `POST /api/auth/login`

-   **Назначение:** Упрощенная аутентификация пользователя и выдача JWT.
-   **Аутентификация:** Не требуется.
-   **Request Body:**
    ```json
    {
      "username": "string"
    }
    ```
-   **Response (200 OK):**
    ```json
    {
      "accessToken": "string" 
    }
    ```
    -   `accessToken`: Стандартный JSON Web Token (JWT), содержащий `userId`, `username` и время жизни.

---

## 2. Matchmaking Service (Сервис Матчмейкинга)

### `POST /api/matchmaking/join`

-   **Назначение:** Поиск подходящей Зоны и получение адреса для подключения.
-   **Аутентификация:** Требуется `Bearer Token` (JWT, полученный от Auth Service).
-   **Request Body:**
    ```json
    {
      "gameMode": "string"
    }
    ```
-   **Response (200 OK):**
    ```json
    {
      "zoneId": "string",
      "websocketUrl": "string" 
    }
    ```
    -   `zoneId`: Уникальный ID Зоны, в которой будет проходить матч.
    -   `websocketUrl`: Полный адрес для подключения к `WebSocket Service` этой Зоны (например, `ws://45.91.236.144:18789`).

---

## 3. WebSocket Service (Игровое соединение)

Клиент использует `websocketUrl`, полученный от Матчмейкера, для установки соединения.

### Процесс подключения:

1.  Клиент открывает WebSocket соединение по адресу `websocketUrl`.
2.  **Сразу после подключения**, клиент должен отправить первое сообщение — **аутентификационное**.

### WebSocket Сообщения (контракты)

Сообщения передаются в бинарном формате, здесь для наглядности представлен их логический JSON-эквивалент.

#### 1. `client.authenticate` (Клиент -> Сервер)

-   **Назначение:** Аутентификация клиента на WebSocket сервере. **Должно быть первым сообщением.**
-   **Payload:**
    ```json
    {
      "type": "authenticate",
      "token": "string" 
    }
    ```
    -   `token`: `accessToken` (JWT), полученный от Auth Service.

#### 2. `server.authenticate.success` (Сервер -> Клиент)

-   **Назначение:** Уведомление об успешной аутентификации и готовности к игре.
-   **Payload:**
    ```json
    {
      "type": "authenticate_success",
      "matchId": "string",
      "playerId": "string"
    }
    ```
    -   `matchId`: ID конкретного матча, к которому подключен игрок.
    -   `playerId`: ID игрока, извлеченный из JWT.

#### 3. `client.input` (Клиент -> Сервер)

-   **Назначение:** Отправка ввода игрока.
-   **Payload:** Бинарная структура `PlayerInput`.

#### 4. `server.state` (Сервер -> Клиент)

-   **Назначение:** Отправка состояния мира.
-   **Payload:** Бинарная структура `WorldState`.
